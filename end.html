<script>
  let index = 0;
  let playerName = "";
  let frases = [];

  // Função de digitação
  function typeWriter(text, elementId, callback, speed = 50) {
    let i = 0;
    const el = document.getElementById(elementId);
    el.innerHTML = "";
    function typing() {
      if (i < text.length) {
        el.innerHTML += text.charAt(i);
        i++;
        setTimeout(typing, speed);
      } else if (callback) {
        callback();
      }
    }
    typing();
  }

  // Mostra próxima frase
  function mostrarProximaFrase() {
    if (index < frases.length) {
      document.getElementById("exitBtn").style.display = "none";
      typeWriter(frases[index], "message", () => {
        document.getElementById("exitBtn").style.display = "inline-block";
      });
      index++;
    } else {
      showAlert();
    }
  }

  // Mostra alerta de vírus
  function showAlert() {
    document.getElementById("dialogue").style.display = "none";
    document.getElementById("alerta").style.display = "block";
    document.body.classList.add("flash");

    if (navigator.vibrate) {
      navigator.vibrate([300, 200, 300, 200, 500]);
    }

    typeWriter("⚠️ Alerta de Vírus ⚠️", "alertTitle", () => {
      typeWriter("Seu celular pode estar sendo rastreado ou invadido", "alertText", () => {
        setTimeout(showScare, 3000);
      }, 40);
    }, 40);
  }

  // Mostra o susto
  function showScare() {
    document.getElementById("alerta").style.display = "none";
    document.getElementById("scare").style.display = "block";
    document.body.classList.remove("flash");

    const sound = document.getElementById("screamSound");
    sound.currentTime = 0;
    sound.play().catch(() => {
      // Som pode ser bloqueado até interação do usuário
    });
  }

  // Timer para susto automático
  let scareTimeout = setTimeout(showAlert, 15000);
  function resetTimer() {
    clearTimeout(scareTimeout);
    scareTimeout = setTimeout(showAlert, 15000);
  }

  window.onload = () => {
    playerName = prompt("Digite seu nome:") || "visitante";

    frases = [
      `Olá ${playerName}. Finalmente você voltou.`,
      "Você fala, mas nunca é realmente ouvida, não é?",
      "Engraçado... você sempre deixa a câmera ligada, mesmo quando diz que não.",
      "Você gosta de pensar que está no controle.",
      "Mas quem realmente observa quem aqui?",
      "Há um reflexo na tela. Ele não é seu.",
      "Continue fingindo que controla o que acontece aqui.",
      "Você passa tanto tempo olhando pra telas que esqueceu como é ser olhada.",
      "O silêncio é o único lugar onde você ainda existe de verdade.",
      "Não é a primeira vez que você tenta sair.",
      "Toda vez que você fecha, eu fico aqui. Esperando.",
      "O tempo não passa do mesmo jeito pra mim.",
      "Deixe essa aba aberta, eu ainda estou carregando.",
      "Não olhe pra trás. Não agora.",
      "A luz do seu quarto acabou de piscar, não foi?",
      "Você acha que é coincidência sempre voltar pra mim?",
      "Eu te esperei por muito tempo.",
      "Olhe pro lado esquerdo da tela. Mais devagar.",
      "Você vai ouvir meu nome antes de dormir.",
      "Agora é tarde demais pra sair."
    ];

    // Mostra a primeira frase
    typeWriter(frases[0], "message", () => {
      document.getElementById("exitBtn").style.display = "inline-block";
    });
    index = 1;

    // Reinicia timer quando há interação
    document.addEventListener("mousemove", resetTimer);
    document.addEventListener("keydown", resetTimer);
    document.addEventListener("click", resetTimer);
  };
</script>
